"use strict";(self.webpackChunkh3yun_pdocs=self.webpackChunkh3yun_pdocs||[]).push([[230],{984:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>d,data:()=>k});var e=a(641);const t=a.p+"assets/img/sql-dashboard-1.792adb1c.png",h=a.p+"assets/img/sql-dashboard-2.1cfd1fa6.png",n=a.p+"assets/img/sql-dashboard-3.b209a536.png",l=a.p+"assets/img/sql-dashboard-4.e6887be1.png",p={},d=(0,a(6262).A)(p,[["render",function(i,s){return(0,e.uX)(),(0,e.CE)("div",null,s[0]||(s[0]=[(0,e.Fv)('<p>创建SQL高级数据源路径：<code>头像 -&gt; 高级数据源 -&gt; 新增 -&gt; 新增SQL数据流</code></p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>如果点头像，发现菜单栏没有「高级数据源」，或者点新增没有「新增SQL数据流」，请联系客服进行开通。</p></div><p><img src="'+t+'" alt="创建SQL高级数据源路径-1" width="356" height="469"></p><p><img src="'+h+'" alt="创建SQL高级数据源路径-2" width="636" height="417"></p><h2 id="sql查询的超时时间" tabindex="-1"><a class="header-anchor" href="#sql查询的超时时间"><span>SQL查询的超时时间</span></a></h2><p>目前氚云在定义SQL页面的【校验查询】，和在仪表盘中引用SQL高级数据源查询的超时时间是相同的，都是11秒。</p><p>在使用该功能时请注意不要执行耗时过长的SQL查询，若业务逻辑确实需要，可以考虑新建一个表单作为中间表，由定时器（4小时执行一次，每次有20分钟执行时间）来生成中间表数据，然后仪表盘中直接查询中间表数据。</p><h2 id="动态参数" tabindex="-1"><a class="header-anchor" href="#动态参数"><span>动态参数</span></a></h2><p>SQL高级数据源支持动态参数，做法是在SQL语句中通过 <code>{字段名}</code> 来占位，例如下面SQL中的 <code>{Name}</code> 占位，就表示用 <code>Name</code> 字段来作为筛选条件：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ObjectId </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `userId`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `userName`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">State</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `state`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> H_User </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> State</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在SQL中加入 <code>{字段名}</code> 占位符后，右边动态参数设置会自动出现该参数：</p><p><img src="'+n+'" alt="动态参数-3" width="1916" height="599"></p><p>动态参数的参数类型、逻辑关系会影响最终SQL语句的生成，例如：</p><ol><li>如果参数类型是 <code>单行文本</code>，逻辑关系是 <code>等于</code>，那么生成的SQL语句就是 <code>字段 = &#39;值&#39;</code>；</li><li>如果参数类型是 <code>数字</code>，逻辑关系是 <code>范围</code>，那么生成的SQL语句就是 <code>字段 BETWEEN 最小值 AND 最大值</code>；</li><li>如果参数类型是 <code>日期</code>，逻辑关系是 <code>大于</code>，那么生成的SQL语句就是 <code>字段 &gt; 值</code>；</li></ol><p>保存后，在仪表盘中选择我们编写SQL高级数据源，动态参数会自动出现在仪表盘的筛选条件中：</p><p><img src="'+l+'" alt="动态参数-4" width="1859" height="500"></p><h2 id="常见问题" tabindex="-1"><a class="header-anchor" href="#常见问题"><span>常见问题</span></a></h2><ol><li>SQL高级数据源查询出来的数据，怎么控制数据权限？</li></ol><p>由于使用SQL查询数据，已经脱离系统数据权限的控制，直接访问了数据库，所以需要通过SQL语句来控制数据权限。</p><p>例如再加一个拥有者 <code>OwnerId</code> 参数来控制数据权限：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ObjectId </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `dataId`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `dataName`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> i_表单编码 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> Status</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {OwnerId}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或者加一个所属部门 <code>OwnerDeptId</code> 参数来控制数据权限：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ObjectId </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `dataId`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `dataName`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> i_表单编码 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> Status</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {OwnerDeptId}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>可否在高级数据源中执行 <code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code> 语句？</li></ol><p>不支持，如有执行这些语句的需求，请使用后端代码去执行<a href="/docs/exec-sql" target="_blank" rel="noopener noreferrer">后端执行SQL</a>。</p>',25)]))}]]),k=JSON.parse('{"path":"/docs/sql-dashboard/","title":"SQL高级数据源","lang":"zh-CN","frontmatter":{"title":"SQL高级数据源","createTime":"2025/02/17 19:08:42","permalink":"/docs/sql-dashboard/","description":"创建SQL高级数据源路径：头像 -> 高级数据源 -> 新增 -> 新增SQL数据流 注意 如果点头像，发现菜单栏没有「高级数据源」，或者点新增没有「新增SQL数据流」，请联系客服进行开通。 创建SQL高级数据源路径-1 创建SQL高级数据源路径-2 SQL查询的超时时间 目前氚云在定义SQL页面的【校验查询】，和在仪表盘中引用SQL高级数据源查询的超...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"SQL高级数据源\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-02-21T08:01:52.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://h3yunpro.github.io/h3yunpro.github.io/docs/sql-dashboard/"}],["meta",{"property":"og:site_name","content":"氚专开发者扩展文档"}],["meta",{"property":"og:title","content":"SQL高级数据源"}],["meta",{"property":"og:description","content":"创建SQL高级数据源路径：头像 -> 高级数据源 -> 新增 -> 新增SQL数据流 注意 如果点头像，发现菜单栏没有「高级数据源」，或者点新增没有「新增SQL数据流」，请联系客服进行开通。 创建SQL高级数据源路径-1 创建SQL高级数据源路径-2 SQL查询的超时时间 目前氚云在定义SQL页面的【校验查询】，和在仪表盘中引用SQL高级数据源查询的超..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-21T08:01:52.000Z"}],["meta",{"property":"article:modified_time","content":"2025-02-21T08:01:52.000Z"}]]},"readingTime":{"minutes":2.44,"words":732},"git":{"createdTime":1739878398000,"updatedTime":1740124912000,"contributors":[{"name":"氚云-凡狐","username":"","email":"huca@authine.com","commits":3,"avatar":"https://gravatar.com/avatar/a3f9e039904c5982dd5440c57df0b07fcf3ef5c18622f5eab116ae54c4e39f36?d=retro"}]},"autoDesc":true,"filePathRelative":"notes/docs/数据库/SQL高级数据源.md","headers":[]}')}}]);